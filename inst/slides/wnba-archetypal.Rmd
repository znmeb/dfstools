---
title: "Archetypal Ballers and Ternary Plots"
subtitle: "A look at the 2018 WNBA season"
author: M. Edward (Ed) Borasky
institute: <https://znmeb.github.io/dfstools/>
date: June 8, 2019
output: 
  beamer_presentation:
    theme: EastLansing
bibliography: ternary.bib
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)

## Load libraries and data
library(tidyverse)
wnba_data <- dfstools::player_box_score(
  "~/DFS/NBAStuffer_WNBA/WNBA-2018-Player-BoxScore-Dataset.xlsx"
)

## Prepare archetypal analysis input
player_totals <- wnba_data %>% 
  mutate(player_name = player_full_name) %>% 
  select(
    player_name, tot, x3p, a, st, to, bl, pts, ddbl, tdbl, min, games) %>% 
  group_by(player_name) %>% 
  summarize_if(is.numeric, sum) %>% 
  ungroup()
player_labels <- player_totals %>% select(player_name)

## Compute the three-archetype model
archetypal_analysis <- dfstools::compute_archetypes(
  player_totals, player_labels, num_archetypes = 3)
player_alphas <- archetypal_analysis[["player_alphas"]] %>% 
  mutate(PlayerCode = as_factor(sprintf(
    "%s: Rin %1.4f, Floor %1.4f",
    player_name, 
    Rim, 
    Floor
  )))

```

## Archetypal analysis [@Eugster2009]
* Goal:
    - Dimensionality reduction
    - Reduce a dataset with 17 box score metrics to three archetypes
    - Represent players' skills in terms of the archetypes
* Inputs:
    - Player box scores for the 2018 WNBA season
    - About 160 players
* Outputs:
    - Archetype table
    - Player table

## The three archetypes
* Each archetype represents a skill set
    - Floor Spacing [@Shea2014, chapter 5]: 
        - skills for a backcourt player (Guard) 
        - dominated by three-point shooting
    - Rim Protection [@Shea2014, chapter 6]: 
        - skills for a frontcourt player (Center, Forward)
        - dominated by rebounding
    - Bench: the "bad" archetype - players with low overall skills
        - the best players have a "Bench" value near zero

## The archetype table
* Rows are archetypes, columns are box score metrics
* Metrics can be raw or scaled
* For this analysis I used raw metrics - season totals

## Sample archetype table
```{r}
atx <- t(
  archetypal_analysis$archetype_parameters %>%
    filter(statistic != "ddbl", statistic != "tdbl", statistic != "games") %>% 
    column_to_rownames(var = "statistic") %>% 
    round(digits = 1)
  )
knitr::kable(atx, format = "latex")

```
* `tot` = total rebounds (offensive + defensive)
* `x3p` = three-point shots made

## The player table
* Rows are players, columns are archetypes
* For each archetype
    - the _archetypal player_ has the largest value for the archetype
    - this value is usually very close to 1.0
    - the other values for an archetypal player will be very close to zero
* For other players
    - a fraction of the archetypal player's value in each archetype
* For all players
    - Floor + Rim + Bench = 1
    - Floor + Rim = (1 - Bench) is a measure of overall skill

## Sample player table
```{r}
ptx <- player_alphas[, 1:4] %>%  
  top_n(12, -Bench) %>% 
  arrange(Bench) 
colnames(ptx)[1] <- "Player"
ptx[, 2:4] <- round(ptx[, 2:4], 4)
knitr::kable(ptx, format = "latex")

```

## Ternary plots [@Hamilton2018]
* Floor, Rim and Bench sum to 1.0
* So we can plot them on a ternary plot
    - equilateral triangle with the corners labeled Rim, Floor and Bench
    - The poor players cluster near "Bench"
    - The good rebounders cluster near "Rim"
    - The good three-point shooters cluster near "Floor"
    - And the All-Stars are near the Rim - Floor line

_Who are the archetypal floor spacers and rim protectors in the WNBA?_


## 2018 WNBA top twelve overall - the All-Stars
```{r}
dfstools::ternary_plot(
  player_alphas %>% 
    top_n(12, -Bench) %>% 
    arrange(Bench) %>% 
    mutate(Player = fct_reorder(PlayerCode, -Rim)), 
  plot_title = "2018 WNBA Top Twelve Overall")

```

## 2018 WNBA top twelve floor spacers
```{r}
dfstools::ternary_plot(
  player_alphas %>% 
    top_n(12, Floor) %>% 
    arrange(desc(Floor)) %>% 
    mutate(Player = fct_reorder(PlayerCode, -Floor)), 
  plot_title = "2018 WNBA Top Twelve Floor Spacers")

```

## 2018 WNBA top twelve rim protectors
```{r}
dfstools::ternary_plot(
  player_alphas %>% 
    top_n(12, Rim) %>% 
    arrange(desc(Rim)) %>% 
    mutate(Player = fct_reorder(PlayerCode, -Rim)), 
  plot_title = "2018 WNBA Top Twelve Rim Protectors")

```

## References
